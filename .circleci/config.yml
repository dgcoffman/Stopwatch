version: 2

jobs:
    UITest:
        macos:
            xcode: '10.2.0'

        steps:
            - checkout

            - run:
                name: Bundle install
                command: bundle install

            - run:
                name: Build and Run UI tests
                command: Scripts/uitest

            - store_test_results:
                path: TestResults

            - store_artifacts:
                path: TestResults

    UnitTest:
        macos:
            xcode: '10.2.0'

        steps:
            - checkout

            - run:
                name: Bundle install
                command: bundle install

            - run:
                name: Run unit tests
                command: Scripts/unittest

            - store_test_results:
                path: TestResults

            - store_artifacts:
                path: TestResults

    SwiftLint:
        docker:
            - image: dantoml/swiftlint:latest

        steps:
            - checkout

            - run:
                name: Run SwiftLint
                command: mkdir test-results test-results/swiftlint && swiftlint lint Stopwatch StopwatchTests StopwatchUITests --reporter junit | tee test-results/swiftlint/result.xml

            - store_artifacts:
                path: test-results

            - store_test_results:
                path: test-results

    SwiftFormat:
        macos:
            xcode: '10.2.0'

        steps:
            - checkout
            - run:
                name: Verify SwiftFormat does not introduce changes
                command: ./Pods/SwiftFormat/CommandLineTool/swiftformat --exclude Pods --lint .

workflows:
    version: 2
    build-test-lint:
        jobs:
            - SwiftLint
            - SwiftFormat
            - UnitTest
            - UITest
